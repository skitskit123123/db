CREATE TABLE EMPLOYEE (SSN NUMBER(9),
     NAME VARCHAR(20),
     ADDRESS VARCHAR(25),
     SEX CHAR,
     SALARY NUMBER(10,2),
     SUPERSSN NUMBER(9),
     DNO NUMBER(2),
     CONSTRAINT PA PRIMARY KEY(SSN),
      CONSTRAINT PB FOREIGN KEY(SUPERSSN) REFERENCES EMPLOYEE(SSN) ON DELETE CASCADE);
CREATE TABLE DEPARTMENT (DNO NUMBER(2),
    DNAME VARCHAR(15),
    MGRSSN NUMBER(9),
    MGRSTARTDATE DATE,
    CONSTRAINT PC PRIMARY KEY(DNO),
    CONSTRAINT PKD FOREIGN KEY(MGRSSN) REFERENCES EMPLOYEE(SSN)  ON DELETE CASCADE);
ALTER TABLE EMPLOYEE ADD CONSTRAINT PE FOREIGN KEY (DNO) REFERENCES DEPARTMENT (DNO) ON DELETE  CASCADE;
CREATE TABLE DLOCATION (DNO NUMBER(2),
    DLOC VARCHAR(15),
    CONSTRAINT CPK PRIMARY KEY (DNO,DLOC),
    CONSTRAINT FK_D1 FOREIGN KEY (DNO) REFERENCES DEPARTMENT (DNO) ON DELETE CASCADE);
CREATE TABLE PROJECT (PNO NUMBER(2),
    PNAME VARCHAR(15),
    PLOCATION VARCHAR(15),
    DNO NUMBER(2),
    CONSTRAINT PKP PRIMARY KEY(PNO),
    CONSTRAINT FKD FOREIGN KEY (DNO) REFERENCES DEPARTMENT (DNO) ON DELETE CASCADE);
CREATE TABLE WORKS_ON (SSN NUMBER(9),
    PNO NUMBER(2),
   HOURS NUMBER(3),
    CONSTRAINT SP PRIMARY KEY (SSN,PNO),
    CONSTRAINT FKS FOREIGN KEY (SSN) REFERENCES EMPLOYEE (SSN) ON DELETE CASCADE,
    CONSTRAINT FKP FOREIGN KEY (PNO) REFERENCES PROJECT (PNO) ON DELETE CASCADE);

INSERT INTO EMPLOYEE VALUES ('ATMEECE01','JOHN','SCOTT','BANGALORE','M', 450000,NULL,NULL);
INSERT INTO EMPLOYEE VALUES ('ATMECSE01','JAMES','SMITH','BANGALORE','M', 500000,NULL,NULL);
INSERT INTO EMPLOYEE VALUES ('ATMECSE02','HEARN','BAKER','BANGALORE','M', 700000,NULL,NULL);
INSERT INTO EMPLOYEE VALUES ('ATMECSE03','EDWARD','SCOTT','MYSORE','M', 500000,NULL,NULL);
INSERT INTO EMPLOYEE VALUES ('ATMECSE04','PAVAN','HEGDE','MANGALORE','M', 650000,NULL,NULL);
INSERT INTO EMPLOYEE VALUES ('ATMECSE05','GIRISH','MALYA','MYSORE','M', 450000,NULL,NULL);
INSERT INTO EMPLOYEE VALUES ('ATMECSE06','NEHA','SN','BANGALORE','F', 800000,NULL,NULL);
INSERT INTO EMPLOYEE VALUES ('ATMEACC01','AHANA','K','MANGALORE','F', 350000,NULL,NULL);
INSERT INTO EMPLOYEE VALUES ('ATMEACC02','SANTHOSH','KUMAR','MANGALORE','M', 300000,NULL,NULL); 
INSERT INTO EMPLOYEE VALUES ('ATMEISE01','VEENA','M','MYSORE','F', 600000,NULL,NULL);
INSERT INTO EMPLOYEE VALUES ('ATMEIT01','NAGESH','HR','BANGALORE','M', 500000,NULL,NULL);

INSERT INTO DEPARTMENT VALUES ('1','ACCOUNTS','2001-01-01','ATMEACC02'); 
INSERT INTO DEPARTMENT VALUES ('2','IT','2016-08-01','ATMEIT01');
INSERT INTO DEPARTMENT VALUES ('3','ECE','2008-6-01','ATMEECE01'); 
INSERT INTO DEPARTMENT VALUES ('4','ISE','2015-06-01','ATMEISE01'); 
INSERT INTO DEPARTMENT VALUES ('5','CSE','2002-06-01','ATMECSE05');

INSERT INTO DLOCATION VALUES ('BANGALORE', '1'); 
INSERT INTO DLOCATION VALUES ('BANGALORE', '2'); 
INSERT INTO DLOCATION VALUES ('BANGALORE', '3'); 
INSERT INTO DLOCATION VALUES ('MANGALORE', '4'); 
INSERT INTO DLOCATION VALUES ('MANGALORE', '5');

INSERT INTO PROJECT VALUES (100,'IOT','BANGALORE','5'); 
INSERT INTO PROJECT VALUES (101,'CLOUD','BANGALORE','5'); 
INSERT INTO PROJECT VALUES (102,'BIGDATA','BANGALORE','5'); 
INSERT INTO PROJECT VALUES (103,'SENSORS','BANGALORE','3');
INSERT INTO PROJECT VALUES (104,'BANK MANAGEMENT','BANGALORE','1'); 
INSERT INTO PROJECT VALUES (105,'SALARY MANAGEMENT','BANGALORE','1');


INSERT INTO PROJECT VALUES (106,'OPENSTACK','BANGALORE','4'); INSERT INTO PROJECT VALUES (107,'SMART CITY','BANGALORE','2');
INSERT INTO WORKS_ON VALUES (4, 'ATMECSE01', 100); INSERT INTO WORKS_ON VALUES (6, 'ATMECSE01', 101); INSERT INTO WORKS_ON VALUES (8, 'ATMECSE01', 102); INSERT INTO WORKS_ON VALUES (10, 'ATMECSE02', 100);
INSERT INTO WORKS_ON VALUES (4, 'ATMECSE05', 101); INSERT INTO WORKS_ON VALUES (5, 'ATMECSE06', 102); INSERT INTO WORKS_ON VALUES (6, 'ATMECSE03', 102); INSERT INTO WORKS_ON VALUES (7, 'ATMEECE01', 103); INSERT INTO WORKS_ON VALUES (5, 'ATMEACC01', 104); INSERT INTO WORKS_ON VALUES (6, 'ATMEACC02', 105); INSERT INTO WORKS_ON VALUES (4, 'ATMEISE01', 106); INSERT INTO WORKS_ON VALUES (10, 'ATMEIT01', 107);



(SELECT DISTINCT P.PNO
    FROM PROJECT P,DEPARTMENT D,EMPLOYEE E
    WHERE P.DNO=D.DNO AND  D.MGRSSN=E.SSN AND E.NAME='SCOTT')
 UNION
 (SELECT DISTINCT P.PNO
 FROM PROJECT P,WORKS_ON W,EMPLOYEE E
 WHERE P.PNO=W.PNO  AND W.SSN=E.SSN  AND E.NAME='SCOTT');

 SELECT E.NAME,1.1*E.SALARY AS HIKE_SALARY
 FROM EMPLOYEE E,WORKS_ON W,PROJECT P
 WHERE E.SSN=W.SSN  AND P.PNO=W.PNO  AND P.PNAME='IOT';

 SELECT SUM(E.SALARY) AS SUM_SAL,MAX(E.SALARY) AS MAX_SAL,MIN(E.SALARY) AS MIN_SAL,AVG(E.SALARY) AS AVG_SAL 
FROM EMPLOYEE E,DEPARTMENT D
WHERE E.DNO=D.DNO AND D.DNAME='ACCOUNTS';

SELECT E.NAME   FROM EMPLOYEE E
         WHERE NOT EXISTS((SELECT P.PNO FROM PROJECT P WHERE P.DNO=5)
         MINUS (SELECT W.PNO FROM WORKS_ON W WHERE E.SSN=W.SSN));


SELECT DNO,COUNT(*) AS NO_OF_EMP
 FROM EMPLOYEE 
 WHERE SALARY>600000 AND DNO IN(SELECT DNO 
                                FROM EMPLOYEE
                                GROUP BY(DNO)
                                HAVING COUNT(*)>5)
  GROUP BY DNO;
